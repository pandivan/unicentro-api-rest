SELECT count(1), [Fecha Factura]
--count(1) 
--min([Fecha Factura]), max([Fecha Factura])
--[DIspositivo de Pago], [Punto de Pago], Id_Billing, Turno, Id_Transaction, [Consola de Entrada], [Consola Ing], [Id Factura], [Fecha Factura], [Numero de Tarjeta], 
--[Minutos Facturados], [Total Sin Iva], Iva, SubTotal, Ajuste, Total, [Minutos Convenio], [Total Convenio], 
--Recibo, IsDelete, Prefijo, Id_Rate, Tarifa, Id_DeviceParent, Id_TransactionParent, Id_TransactionCategory, Placa, Zona, Placa2 
FROM CI_ControlAccessDb_New.dbo.View_Qlik_Parking
--where [Fecha Factura] >= DATEADD(month, -1, getdate())
group by [Fecha Factura] HAVING count(1) > 1
;



SELECT getdate();

SELECT DATEADD(month, 1, '20060830');

SELECT DATEADD(month, -1, getdate());

CREATE UNIQUE CLUSTERED INDEX IDX_V1 ON Sales.vOrders (OrderDate, ProductID);

CREATE UNIQUE CLUSTERED INDEX IDX_View_Qlik_Parking ON CI_ControlAccessDb_New.dbo.View_Qlik_Parking ([Fecha Factura]);

SELECT DATEADD(yy,DATEDIFF(yy,0,GETDATE()),0);


--select count(cantidad) from ( 
select * /*
      p.Id_Billing as cantidad, 
      p.[Punto de Pago] punto_pago, 
      p.[Consola Ing] as entrada, 
      p.[Fecha Factura] as fecha_ingreso, 
      case when 0 != p.[Minutos Facturados] then (p.[Minutos Facturados] / 60) else 0 end as horas, 
      p.[Minutos Facturados] as minutos, 
      case p.Total WHEN 0 THEN p.[Total Convenio] ELSE p.Total end as valor, 
      p.Tarifa as descripcion, 
      case when 0 != CHARINDEX('bicicleta', LOWER(p.Tarifa)) then 'BICICLETA' else UPPER(p.Zona) end tipos_vehiculo,
      p.Placa2 as vehiculo,
      case when p.[Minutos Facturados] <= 60 then 1 when (p.[Minutos Facturados] > 60 and p.[Minutos Facturados] <= 120) then 2 when (p.[Minutos Facturados] > 120 and p.[Minutos Facturados] <= 180) then 3 when (p.[Minutos Facturados] > 180 and p.[Minutos Facturados] <= 240) then 4 else 5 end as rango
      ,DATEPART(HOUR, p.[Fecha Factura]) hora, p.[Id Factura] */
      from CI_ControlAccessDb_New.dbo.View_Qlik_Parking p WITH (NOLOCK)
where
1=1
and p.[Fecha Factura] >= '23/03/2021' --and p.[Fecha Factura] <= '23/03/2021'
and p.Placa2 in ('MWX171','AVA363')
--and p.Id_Billing in (1616542442150,1616542430145,1616542412238,1616542389584,1616542370044,1616542321984,1616542295333,1616542262238,1616542222716,1616542195405,1616542177718,1616542159195,1616542153778,1616542138265,1616542122230,1616542120590,1616542104993,1616542076855,1616542054503,1616542034580,1616542017939,1616542041895,1616541983934,1616541923665,1616541907285,1616541891602,1616541892308,1616541878755,1616541849072,1616541832313,1616541809135,1616541791171,1616541777880,1616541664524,1616541656393,1616541650437,1616541638757,1616541636290,1616541601562,1616541597687,1616541570241,1616541552142,1616541537473,1616541518986,1616541496360,1616541475834,1616541452488,1616541432945,1616541400098,1616541376385,1616541360368,1616541345079,1616541326518,1616541272209,1616541243767,1616541225411,1616541217062,1616541202234,1616541177112,1616541159777,1616541170296,1616541138550,1616541027925,1616541013776,1616540985063,1616540932256,1616540919140,1616540904562,1616540894154,1616540863190,1616540821405,1616540828122,1616540804559,1616540780862,1616540781038,1616540757333,1616540741758,1616540721725,1616540716880,1616540702413,1616540694368,1616540686647,1616540651472,1616540629537,1616540592606,1616540568210,1616540543345,1616540453924,1616540447976,1616540343816,1616540326308,1616540318379,1616540273758,1616540274044,1616540253050,1616540256205,1616540239413,1616540224016,1616540236058,1616540206589,1616540189018,1616540165919,1616540161809,1616540107159,1616540091028,1616540073314,1616540044357,1616540007745,1616539981189,1616539961895,1616539940261,1616539923318,1616539919298,1616539900758,1616539893671,1616539881209,1616539869960,1616539852582,1616539859831,1616539834564,1616539790067,1616539751090,1616539730048,1616539710095,1616539686590,1616539657303,1616539648541,1616539635417,1616539598036,1616539503674,1616539484089,1616539459226,1616539448926,1616539416838,1616539414958,1616539377113,1616539353734,1616539352313,1616539320404,1616539277200,1616539285326,1616539241725,1616539151746,1616539132958,1616539115195,1616539106960,1616539084305,1616539064017,1616539048763,1616539027950,1616538998082,1616538994389,1616538981988,1616538966121,1616538946806,1616538925287,1616538915106,1616538909767,1616538889764,1616538873342,1616538854300,1616538832877,1616538789038,1616538657390,1616538644305,1616538615887,1616538599666,1616538598587,1616538578860,1616538572148,1616538511100,1616538488909,1616538468052,1616538439472,1616538423660,1616538409175,1616538389445,1616538366454,1616538333289,1616538320075,1616538317605,1616538298281,1616538266739,1616538248490,1616538215132,1616538186492,1616538165566,1616538142589,1616538103195,1616538078428,1616538056940,1616538039004,1616538025301,1616537995131,1616537958840,1616537940948,1616537892168,1616537840318,1616537820256,1616537805318,1616537727741,1616537684528,1616537678431,1616537655734,1616537652447,1616537588957,1616537535118,1616537514305,1616537489008,1616537471327,1616537466335,1616537457355,1616537411741,1616537352745,1616537268742,1616537283429,1616537252065,1616537247683,1616537223847,1616537226833,1616537202600,1616537195929,1616537185620,1616537169538,1616537153388,1616537131722,1616537118900,1616537115222,1616537096981,1616537094358,1616537077636,1616537052873,1616537014645,1616536992102,1616536975825,1616536969263,1616536942871,1616536922245,1616536908514,1616536885983,1616536847227,1616536829005,1616536810426,1616536788890,1616536767672,1616536760704,1616536751477,1616536736210,1616536718944,1616536716341,1616536700524,1616536683017,1616536681517,1616536662519,1616536646548,1616536632973,1616536606480,1616536589774,1616536573707,1616536549773,1616536515543,1616536492245,1616536457825,1616536400372,1616536378237,1616536363820,1616536334620,1616536309727,1616536292443,1616536266383,1616536258669,1616536247069,1616536225836,1616536179919,1616536165381,1616536100043,1616536081819,1616536057146,1616536031824,1616536009952,1616535988061,1616535986320,1616535967438,1616535954043,1616535932391,1616535906875,1616535888410,1616535868506,1616535845096,1616535828470,1616535814766,1616535800333,1616535781241,1616535763543,1616535743459,1616535723409,1616535705888,1616535654905,1616535622077,1616535603438,1616535588584,1616535571634,1616535552433,1616535490833,1616535490597,1616535440360,1616535418885,1616535400529,1616535384076,1616535364699,1616535348234,1616535331333,1616535314068,1616535294051,1616535274047,1616535249810,1616535226116,1616535206735,1616535187489,1616535169419,1616535145517,1616535111127,1616535109189,1616535075663,1616535063368,1616535046825,1616535027542,1616535002138,1616535008295,1616534978035,1616534962633,1616534958567,1616534942382,1616534926672,1616534906769,1616534885921,1616534843135,1616534815844,1616534789335,1616534769812,1616534770198,1616534748038,1616534725030,1616534731139,1616534694414,1616534677944,1616534661302,1616534625523,1616534587994,1616534558468,1616534526631,1616534503690,1616534474834,1616534430642,1616534403369,1616534376345,1616534321095,1616534302290,1616534284558,1616534263516,1616534250628,1616534226521,1616534215337,1616534201196,1616534189133,1616534170412,1616534181453,1616534143670,1616534113835,1616534072186,1616534053497,1616534031400,1616533985147,1616533970278,1616533946106,1616533931748,1616533913424,1616533907250,1616533895166,1616533873885,1616533866912,1616533850034,1616533846897,1616533832426,1616533829390,1616533805152,1616533777817,1616533721412,1616533723272,1616533703583,1616533683965,1616533699395,1616533665658,1616533644027,1616533624106,1616533622841,1616533605128,1616533571476,1616533544489,1616533522085)
--[Fecha Factura] >= DATEADD(yy,DATEDIFF(yy,0,GETDATE()),0)
--and DATEPART(HOUR, p.[Fecha Factura]) = 18
--p.[Fecha Factura] >= getdate()
--and p.[Minutos Facturados] = 0 
--order by p.[Fecha Factura] desc
--) as t
;

MWX171 --> 
AVA363 


select * --Id_Billing, Id_Transaction, [Fecha Factura], [Numero de Tarjeta], [Minutos Facturados], Total, [Minutos Convenio], [Total Convenio], Id_TransactionParent, Placa2 
from CI_ControlAccessDb_New.dbo.View_Qlik_Parking p WITH (NOLOCK)
where 1=1
and p.[Fecha Factura] >= '08/04/2021'
--and p.Placa2 in ('MWX171','AVA363')
--and p.Id_Billing in (1616542442150,1616542430145,1616542412238,1616542389584,1616542370044,1616542321984,1616542295333,1616542262238,1616542222716,1616542195405,1616542177718,1616542159195,1616542153778,1616542138265,1616542122230,1616542120590,1616542104993,1616542076855,1616542054503,1616542034580,1616542017939,1616542041895,1616541983934,1616541923665,1616541907285,1616541891602,1616541892308,1616541878755,1616541849072,1616541832313,1616541809135,1616541791171,1616541777880,1616541664524,1616541656393,1616541650437,1616541638757,1616541636290,1616541601562,1616541597687,1616541570241,1616541552142,1616541537473,1616541518986,1616541496360,1616541475834,1616541452488,1616541432945,1616541400098,1616541376385,1616541360368,1616541345079,1616541326518,1616541272209,1616541243767,1616541225411,1616541217062,1616541202234,1616541177112,1616541159777,1616541170296,1616541138550,1616541027925,1616541013776,1616540985063,1616540932256,1616540919140,1616540904562,1616540894154,1616540863190,1616540821405,1616540828122,1616540804559,1616540780862,1616540781038,1616540757333,1616540741758,1616540721725,1616540716880,1616540702413,1616540694368,1616540686647,1616540651472,1616540629537,1616540592606,1616540568210,1616540543345,1616540453924,1616540447976,1616540343816,1616540326308,1616540318379,1616540273758,1616540274044,1616540253050,1616540256205,1616540239413,1616540224016,1616540236058,1616540206589,1616540189018,1616540165919,1616540161809,1616540107159,1616540091028,1616540073314,1616540044357,1616540007745,1616539981189,1616539961895,1616539940261,1616539923318,1616539919298,1616539900758,1616539893671,1616539881209,1616539869960,1616539852582,1616539859831,1616539834564,1616539790067,1616539751090,1616539730048,1616539710095,1616539686590,1616539657303,1616539648541,1616539635417,1616539598036,1616539503674,1616539484089,1616539459226,1616539448926,1616539416838,1616539414958,1616539377113,1616539353734,1616539352313,1616539320404,1616539277200,1616539285326,1616539241725,1616539151746,1616539132958,1616539115195,1616539106960,1616539084305,1616539064017,1616539048763,1616539027950,1616538998082,1616538994389,1616538981988,1616538966121,1616538946806,1616538925287,1616538915106,1616538909767,1616538889764,1616538873342,1616538854300,1616538832877,1616538789038,1616538657390,1616538644305,1616538615887,1616538599666,1616538598587,1616538578860,1616538572148,1616538511100,1616538488909,1616538468052,1616538439472,1616538423660,1616538409175,1616538389445,1616538366454,1616538333289,1616538320075,1616538317605,1616538298281,1616538266739,1616538248490,1616538215132,1616538186492,1616538165566,1616538142589,1616538103195,1616538078428,1616538056940,1616538039004,1616538025301,1616537995131,1616537958840,1616537940948,1616537892168,1616537840318,1616537820256,1616537805318,1616537727741,1616537684528,1616537678431,1616537655734,1616537652447,1616537588957,1616537535118,1616537514305,1616537489008,1616537471327,1616537466335,1616537457355,1616537411741,1616537352745,1616537268742,1616537283429,1616537252065,1616537247683,1616537223847,1616537226833,1616537202600,1616537195929,1616537185620,1616537169538,1616537153388,1616537131722,1616537118900,1616537115222,1616537096981,1616537094358,1616537077636,1616537052873,1616537014645,1616536992102,1616536975825,1616536969263,1616536942871,1616536922245,1616536908514,1616536885983,1616536847227,1616536829005,1616536810426,1616536788890,1616536767672,1616536760704,1616536751477,1616536736210,1616536718944,1616536716341,1616536700524,1616536683017,1616536681517,1616536662519,1616536646548,1616536632973,1616536606480,1616536589774,1616536573707,1616536549773,1616536515543,1616536492245,1616536457825,1616536400372,1616536378237,1616536363820,1616536334620,1616536309727,1616536292443,1616536266383,1616536258669,1616536247069,1616536225836,1616536179919,1616536165381,1616536100043,1616536081819,1616536057146,1616536031824,1616536009952,1616535988061,1616535986320,1616535967438,1616535954043,1616535932391,1616535906875,1616535888410,1616535868506,1616535845096,1616535828470,1616535814766,1616535800333,1616535781241,1616535763543,1616535743459,1616535723409,1616535705888,1616535654905,1616535622077,1616535603438,1616535588584,1616535571634,1616535552433,1616535490833,1616535490597,1616535440360,1616535418885,1616535400529,1616535384076,1616535364699,1616535348234,1616535331333,1616535314068,1616535294051,1616535274047,1616535249810,1616535226116,1616535206735,1616535187489,1616535169419,1616535145517,1616535111127,1616535109189,1616535075663,1616535063368,1616535046825,1616535027542,1616535002138,1616535008295,1616534978035,1616534962633,1616534958567,1616534942382,1616534926672,1616534906769,1616534885921,1616534843135,1616534815844,1616534789335,1616534769812,1616534770198,1616534748038,1616534725030,1616534731139,1616534694414,1616534677944,1616534661302,1616534625523,1616534587994,1616534558468,1616534526631,1616534503690,1616534474834,1616534430642,1616534403369,1616534376345,1616534321095,1616534302290,1616534284558,1616534263516,1616534250628,1616534226521,1616534215337,1616534201196,1616534189133,1616534170412,1616534181453,1616534143670,1616534113835,1616534072186,1616534053497,1616534031400,1616533985147,1616533970278,1616533946106,1616533931748,1616533913424,1616533907250,1616533895166,1616533873885,1616533866912,1616533850034,1616533846897,1616533832426,1616533829390,1616533805152,1616533777817,1616533721412,1616533723272,1616533703583,1616533683965,1616533699395,1616533665658,1616533644027,1616533624106,1616533622841,1616533605128,1616533571476,1616533544489,1616533522085)
--and p.[Minutos Facturados] = 0 
--and [Id Factura] is null 
--and [Fecha Factura] = ''
order by p.[Fecha Factura] desc
;


SELECT * 
FROM CI_ControlAccessDb_New.dbo.Tb_Transaction t --inner join CI_ControlAccessDb_New.dbo.Tb_TransactionValues tv on t.Id_Transaction = tv.Id_Transaction 
where t.TransactionDate >= '08/04/2021'
--t.Id_Transaction in ('21-669832470','2-669828542','4-669833544') or t.Id_TransactionParent in ('21-669832470','2-669828542','4-669833544')
;

SELECT * FROM CI_ControlAccessDb_New.dbo.Tb_Billing
where 1=1
--and Id_Transaction in ('21-669832470','2-669828542','4-669833544')
--and Id_Billing in ('1616531347827','1616531347988','1616536363162','1616536354563')
---and InvoiceDate >= '29/03/2021'
;

SELECT * FROM CI_ControlAccessDb_New.dbo.Tb_BillingItem
--where Id_Billing in ('1616535274047')
;


SELECT * 
from CI_ControlAccessDb_New.dbo.Tb_Shift
where Id_Shift = 1715
;



SELECT * from CI_ControlAccessDb_New.dbo.Tb_TransactionValues t
where 1=1
and t.Id_Transaction = '21-669832470'
--and t.Id_TransactionValue in ('1616531347988','1616536354563')
--and t.Value = 'MWX171'
;

Centro Comercial Unicentro Pasto \nNIT 900.317.814-5\nCalle 11 Nº 34-78\nAvenida Panamericana - La Aurora\nTel: 7228114\n
Fecha:         2021-03-23 23:28:08\n\n
Id Turno:      1715\n
Fecha Inicio:  2021-03-23 15:27:36\n
Fecha Cierre:  2021-03-23 23:28:08\n
Cajero Inicio: Punto Automatico\n
Cajero Cierre: Punto Automatico\n
Terminal:      PQ2\n
Factura Ini:   767737\n
Factura Fin:   768347\n
No. Facturas:  746\n\n



SELECT * from CI_ControlAccessDb_New.dbo.Tb_Device;





select *  
from CI_ControlAccessDb_New.dbo.View_Qlik_Parking p WITH (NOLOCK)
where 1=1
and p.[Fecha Factura] >= '26/03/2021'
order by p.[Fecha Factura] desc
;

